<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从输入URL到页面加载发生了什么？ | 李嘉诚的博客</title>
    <meta name="generator" content="VuePress 1.5.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/blog/assets/css/0.styles.f9b52b88.css" as="style"><link rel="preload" href="/blog/assets/js/app.afe45b7e.js" as="script"><link rel="preload" href="/blog/assets/js/2.a28a1508.js" as="script"><link rel="preload" href="/blog/assets/js/20.b1f794ad.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.9530449e.js"><link rel="prefetch" href="/blog/assets/js/11.148dab7e.js"><link rel="prefetch" href="/blog/assets/js/12.a5f0ef57.js"><link rel="prefetch" href="/blog/assets/js/13.ce819e13.js"><link rel="prefetch" href="/blog/assets/js/14.499c1d5b.js"><link rel="prefetch" href="/blog/assets/js/15.7246e577.js"><link rel="prefetch" href="/blog/assets/js/16.17c4d03e.js"><link rel="prefetch" href="/blog/assets/js/17.1e1dff80.js"><link rel="prefetch" href="/blog/assets/js/18.00527491.js"><link rel="prefetch" href="/blog/assets/js/19.b198c725.js"><link rel="prefetch" href="/blog/assets/js/21.70869f2c.js"><link rel="prefetch" href="/blog/assets/js/22.9874c0dd.js"><link rel="prefetch" href="/blog/assets/js/23.54ecd782.js"><link rel="prefetch" href="/blog/assets/js/24.0b4d4f92.js"><link rel="prefetch" href="/blog/assets/js/25.be1ae58c.js"><link rel="prefetch" href="/blog/assets/js/26.a79ad4b8.js"><link rel="prefetch" href="/blog/assets/js/27.7b80718c.js"><link rel="prefetch" href="/blog/assets/js/3.0601f710.js"><link rel="prefetch" href="/blog/assets/js/4.1a9da7e5.js"><link rel="prefetch" href="/blog/assets/js/5.2f8f356e.js"><link rel="prefetch" href="/blog/assets/js/6.4af887db.js"><link rel="prefetch" href="/blog/assets/js/7.fc7489cf.js"><link rel="prefetch" href="/blog/assets/js/8.ee584508.js"><link rel="prefetch" href="/blog/assets/js/9.c8c19a52.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f9b52b88.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">李嘉诚的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/CSS.html" class="nav-link">
  FirstBlog
</a></div> <a href="https://github.com/136917909/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/CSS.html" class="nav-link">
  FirstBlog
</a></div> <a href="https://github.com/136917909/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Blog</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/CSS.html" class="sidebar-link">CSS</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html" class="active sidebar-link">从输入URL到页面加载发生了什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_1-浏览器地址输入url" class="sidebar-link">1.浏览器地址输入URL</a></li><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_2-浏览器查找当前url是否存在缓存" class="sidebar-link">2.浏览器查找当前URL是否存在缓存</a></li><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_3-dns解析url对应ip" class="sidebar-link">3.DNS解析URL对应IP</a></li><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_4-根据ip建立tcp连接-三次握手" class="sidebar-link">4.根据IP建立TCP连接 ——三次握手</a></li><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_5-http-https发起请求-6-服务器处理请求，浏览器接收http响应" class="sidebar-link">5.HTTP/HTTPS发起请求&amp;&amp;6.服务器处理请求，浏览器接收HTTP响应</a></li><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_7-浏览器解析渲染页面" class="sidebar-link">7.浏览器解析渲染页面</a></li><li class="sidebar-sub-header"><a href="/blog/blog/浏览器/从输入URL到页面加载发生了什么.html#_7-关闭tcp连接-四次挥手" class="sidebar-link">7.关闭TCP连接——四次挥手</a></li></ul></li><li><a href="/blog/blog/浏览器/前端安全.html" class="sidebar-link">常见攻击</a></li><li><a href="/blog/blog/浏览器/前端性能优化.html" class="sidebar-link">前端性能优化</a></li><li><a href="/blog/blog/浏览器/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从输入url到页面加载发生了什么？"><a href="#从输入url到页面加载发生了什么？" class="header-anchor">#</a> 从输入URL到页面加载发生了什么？</h1> <h2 id="_1-浏览器地址输入url"><a href="#_1-浏览器地址输入url" class="header-anchor">#</a> 1.浏览器地址输入URL</h2> <p>url一般包含这几个部分.可以顺带提以下知识点</p> <p><strong>知识点:</strong></p> <ul><li><p>协议：主要是HTTP协议，HTTPS协议，FTP协议，FILe协议</p></li> <li><p>域名： 定义因特网<strong>域名</strong>，比如 <a href="http://google.com" target="_blank" rel="noopener noreferrer">google.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>端口号：通常默认都是隐藏的 <strong>http默认端口号为80 https默认端口号为443</strong></p></li> <li><p>补充:  同源策略 - 在前端进行数据请求时，由于浏览器的同源策略，协议，域名，端口号有一个不同会存在跨域请求，需要进行跨域处理</p></li></ul> <h2 id="_2-浏览器查找当前url是否存在缓存"><a href="#_2-浏览器查找当前url是否存在缓存" class="header-anchor">#</a> 2.浏览器查找当前URL是否存在缓存</h2> <p>浏览器首先查询当前URL是否有缓存,有的话,再查询是否过期,没过期则读缓存.过期了则访问web服务器.</p> <p><strong>知识点:</strong> 详细解释可以看本系列的&quot;浏览器缓存&quot;这节.</p> <h2 id="_3-dns解析url对应ip"><a href="#_3-dns解析url对应ip" class="header-anchor">#</a> 3.DNS解析URL对应IP</h2> <h4 id="解析过程"><a href="#解析过程" class="header-anchor">#</a> <strong>解析过程:</strong></h4> <p>1.首先浏览器会查看自己的DNS缓存是否存在.</p> <p>2.如果没有找到,浏览器会<strong>先查找本地hosts文件是否有这个网址映射关系</strong>，如果有就调用这个IP地址映射，完成域名解析。</p> <p>3.如果没有找到,则会在操作系统缓存中查找本地的DNS解析器缓存，如果找到则返回。</p> <p>4.如果没有找到,则会在路由器缓存中进行查找,如果找到则返回。</p> <p>5.如果还是没有找到,则会按ISP(运营商)DNS缓存、根域名服务器、顶级域名服务器、主域名服务器的顺序，逐步读取缓存，直到拿到IP地址.</p> <h2 id="_4-根据ip建立tcp连接-三次握手"><a href="#_4-根据ip建立tcp连接-三次握手" class="header-anchor">#</a> 4.根据IP建立TCP连接 ——三次握手</h2> <h4 id="三次握手的过程"><a href="#三次握手的过程" class="header-anchor">#</a> <strong>三次握手的过程:</strong></h4> <ul><li><strong>客户端发送一个syn包:即带有 SYN=1，Seq=x 的数据包到服务器端口，并进入SYN_SENT状态，等待服务器确认；</strong>（第一次握手，由浏览器发起，告诉服务器我要发送请求了）</li> <li><strong>服务器收到syn包，必须确认客户的SYN，同时发回一个带 SYN=1， ACK=x+1， Seq=y 的响应包以示传达确认信息,即SYN+ACK包，此时服务器进入SYN_RECV状态；</strong>（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）</li> <li><strong>客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK,即回传一个带 ACK=y+1， Seq=Z 的数据包，代表“握手结束”</strong>（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）</li></ul> <h2 id="_5-http-https发起请求-6-服务器处理请求，浏览器接收http响应"><a href="#_5-http-https发起请求-6-服务器处理请求，浏览器接收http响应" class="header-anchor">#</a> 5.HTTP/HTTPS发起请求&amp;&amp;6.服务器处理请求，浏览器接收HTTP响应</h2> <ul><li>完整的HTTP请求包含请求起始行、请求头部、请求主体三部分。</li></ul> <p><img src="https://user-gold-cdn.xitu.io/2019/2/22/1691406a752c9a9b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <ul><li>服务器在收到浏览器发送的HTTP请求之后，会将收到的HTTP报文封装成HTTP的Request对象，并通过不同的Web服务器进行处理，处理完的结果以HTTP的Response对象返回，主要包括状态码，响应头，响应报文三个部分。</li> <li>综合起来,完整的HTTP请报文一般包括了：<strong>通用头部</strong>，<strong>请求/响应头部</strong>，<strong>请求/响应体</strong></li></ul> <h2 id="_7-浏览器解析渲染页面"><a href="#_7-浏览器解析渲染页面" class="header-anchor">#</a> 7.浏览器解析渲染页面</h2> <p>浏览器内核拿到内容后，渲染步骤大致可以分为以下几步：</p> <div class="language- extra-class"><pre class="language-text"><code>1. 解析HTML，构建DOM树

2. 解析CSS，生成CSS规则树

3. 合并DOM树和CSS规则，生成render树

4. 布局render树（Layout/reflow），负责各元素尺寸、位置的计算

5. 绘制render树（paint），绘制页面像素信息

6. 浏览器会将各层的信息发送给GPU，GPU会将各层合成（composite），显示在屏幕上

PS:
reflow：也称作layout，中文叫回流，一般意味着元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树，这个过程称为reflow。

repaint：中文重绘，意味着元素发生的改变只是影响了元素的一些外观之类的时候(例如：背景色，边框颜色，文字颜色等)，此时只需要应用新样式绘制这个元素就可以了。
</code></pre></div><p><strong>预加载扫描器</strong></p> <p>浏览器构建DOM树时，这个过程占用了主线程。当这种情况发生时，预加载扫描仪将解析可用的内容并请求高优先级资源，如CSS、JavaScript和web字体。多亏了预加载扫描器，我们不必等到解析器找到对外部资源的引用来请求它。它将在后台检索资源，以便在主HTML解析器到达请求的资源时，它们可能已经在运行，或者已经被下载。预加载扫描仪提供的优化减少了阻塞。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;link rel=&quot;stylesheet&quot; src=&quot;styles.css&quot;/&gt;
&lt;script src=&quot;myscript.js&quot; async&gt;&lt;/script&gt;
&lt;img src=&quot;myimage.jpg&quot; alt=&quot;image description&quot;/&gt;
&lt;script src=&quot;anotherscript.js&quot; async&gt;&lt;/script&gt;
</code></pre></div><p>在这个例子中，当主线程在解析HTML和CSS时，预加载扫描器将找到脚本和图像，并开始下载它们。为了确保脚本不会阻塞进程，当JavaScript解析和执行顺序不重要时，可以添加async属性或defer属性。</p> <p><strong>等待获取CSS不会阻塞HTML的解析或者下载，但是它的确阻塞JavaScript，因为JavaScript经常用于查询元素的CSS属性。</strong></p> <p><strong>script中defer和async的区别</strong></p> <p>​	<strong>defer</strong>，我们可以认为是将外链的js放在了页面底部。js的加载不会阻塞页面的渲染和资源的加载。不过defer会按照原本的js的顺序执行，所以如果前后有依赖关系的js可以放心使用。</p> <p>​	<strong>async</strong>，这个是html5中新增的属性，它的作用是能够异步的加载和执行脚本，不因为加载脚本而阻塞页面的加载。一旦加载到就会立刻执行在有async的情况下，js一旦下载好了就会执行，所以很有可能不是按照原本的顺序来执行的。如果js前后<strong>有依赖性</strong>，用async，就很有可能<strong>出错</strong>。</p> <p>简单的来说，使用这两个属性会有三种可能的情况</p> <ol><li>如果async为true，那么脚本在下载完成后异步执行。</li> <li>如果async为false，defer为true，那么脚本会在页面解析完毕之后执行。</li> <li>如果async和defer都为false，那么脚本会在页面解析中，停止页面解析，立刻下载并且执行。</li></ol> <h2 id="_7-关闭tcp连接-四次挥手"><a href="#_7-关闭tcp连接-四次挥手" class="header-anchor">#</a> 7.关闭TCP连接——四次挥手</h2> <p>通过四次挥手关闭连接(FIN ACK, ACK, FIN ACK, ACK)。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/2/22/169140a85c0fec37?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <blockquote><ol><li>第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。(第一次挥手：由浏览器发起的，发送给服务器，我请求报文发送完了，你准备关闭吧)</li> <li>第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。(第二次挥手：由服务器发起的，告诉浏览器，我请求报文接受完了，我准备关闭了，你也准备吧)</li> <li>第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。(第三次挥手：由服务器发起，告诉浏览器，我响应报文发送完了，你准备关闭吧)</li> <li>第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。(第四次挥手：由浏览器发起，告诉服务器，我响应报文接受完了，我准备关闭了，你也准备吧)</li></ol></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/blog/webpack/webpack.html" class="prev">
        webpack
      </a></span> <span class="next"><a href="/blog/blog/浏览器/前端安全.html">
        常见攻击
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.afe45b7e.js" defer></script><script src="/blog/assets/js/2.a28a1508.js" defer></script><script src="/blog/assets/js/20.b1f794ad.js" defer></script>
  </body>
</html>
